# Domain-wide search for enabled users whose password has NOT been set since 28/11/2025 (or never set) - $_.Enabled -eq $true change this to show whats not enabled and disable
Import-Module ActiveDirectory

$Cutoff = Get-Date "2025-11-26"
$DomainDN = (Get-ADDomain).DistinguishedName

$Users = Get-ADUser -SearchBase $DomainDN -SearchScope Subtree -Filter * `
  -Properties PasswordLastSet, Enabled, SamAccountName, UserPrincipalName, DisplayName, DistinguishedName |
  Where-Object {
    $_.Enabled -eq $true -and ( ($null -eq $_.PasswordLastSet) -or ($_.PasswordLastSet -lt $Cutoff) ) 
  } |
  Sort-Object PasswordLastSet, SamAccountName

$Users | Select-Object DisplayName, SamAccountName, UserPrincipalName, PasswordLastSet, DistinguishedName

# Optional export
$Users | Export-Csv -NoTypeInformation -Encoding UTF8 -Path "C:\temp\Enabled-Users_PasswordNotReset.csv"
